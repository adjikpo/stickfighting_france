FROM node:20-alpine

WORKDIR /app

# Install pnpm
RUN corepack enable && corepack prepare pnpm@latest --activate

# Copy package files if they exist
COPY package*.json pnpm-lock.yaml* ./

# Install dependencies if package.json exists
RUN if [ -f package.json ]; then pnpm install --frozen-lockfile || pnpm install; fi

# Copy the rest of the application
COPY . .

# Expose the Next.js dev server port
EXPOSE 3000

# Start the development server
CMD ["pnpm", "dev"]
